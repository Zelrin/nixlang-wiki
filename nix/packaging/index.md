---
title: Packaging things with nix
description: All about how to package different thing using the package manager and build tool
published: true
date: 2023-12-29T20:34:43.795Z
tags: package management, guide, derivation
editor: markdown
dateCreated: 2023-12-26T12:08:20.540Z
---

# Packaging things with nix

Nix can be used to build and package software, libraries, files, or just about anything.
Packages in `nix` are also called [derivations](/nix/derivation).

> This page explains the basic function for creating a derivation in nix. It's very bare bones as `nix` is written to be able to package nearly anything. See [mkDerivation](/nix/packaging/mkDerivation) for a **higher level** wrapper and others built on top of that.
{.is-warning}

## The basic derivation

`derivation` is a [builtin][builtins] function that is dumb: the processes behind it are intricate but the general algorith is not. You can read the [reference][derivationRef] if that's more your thing.

 1. take an attribute set (aka a dict in other languages) as input
 1. convert each attribute (key in other languages) in the set to an environment variable
 1. call the builder defined by the attribute set with the environment variables
 1. expect outputs specified by the attribute set to exist
 1. copy each output to the [nix store]

From this we can glean:

 - there is a single input structure (the attribute set)
 - the attribute set needs to define a `builder`
 - the attribute set needs to define a list of `outputs`

Well, wouldn't you know it, `builder` is a required attribute! It has to be a string or pat to an executable.

`outputs` also exists, but is optional as is has one element by default `"out"`. Every element will be available as an environment variable with a computed value to a path (in the [nix store] aka store path). 

There are 2 more mandatory attributes:

 - name: appended to a computed path for the [nix store]
 - system: a string defining on which system the `builder` is expected to run e.g `x86_64-linux`
 
 ```diagram
PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIzOTZweCIgaGVpZ2h0PSI2MTFweCIgdmlld0JveD0iLTAuNSAtMC41IDM5NiA2MTEiIGNvbnRlbnQ9IiZsdDtteGZpbGUgaG9zdD0mcXVvdDtlbWJlZC5kaWFncmFtcy5uZXQmcXVvdDsgbW9kaWZpZWQ9JnF1b3Q7MjAyMy0xMi0yOVQxNDoyNjoyNS40MjRaJnF1b3Q7IGFnZW50PSZxdW90O01vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NDsgcnY6MTIwLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTIwLjAmcXVvdDsgdmVyc2lvbj0mcXVvdDsyMi4xLjE2JnF1b3Q7IGV0YWc9JnF1b3Q7TVhDR3BwNFNaYkhkblY2bTlWX3omcXVvdDsgdHlwZT0mcXVvdDtlbWJlZCZxdW90OyZndDsmbHQ7ZGlhZ3JhbSBpZD0mcXVvdDtQR09OTTJ3d2ZiaXdqa2J6WFpfOSZxdW90OyBuYW1lPSZxdW90O1BhZ2UtMSZxdW90OyZndDsxVmhiYzZNMkZQNDFmclNIaXpIT1krMGszWWZzVEtacHArM1RqakF5cUJFY1ZnaU05OWYzU0VoZ0RFazh1MDYybmNrNFBoL25wbk1WbnZuYnJQbFZrQ0w5RERIbE04K0ptNWwvTy9POEd6ZkVUd1VjVzJDOThsc2dFU3h1SWJjSG50ZzNha0RIb0JXTGFUbGdsQUJjc21JSTdpRFA2VTRPTUNJRUhJWnNlK0JEcXdWSjZBaDQyaEUrUnY5a3NVek5LUUtueHo5UmxxVFdzdXVZSnhteHpBWW9VeExENFFUeTcyYitWZ0RJOWx2V2JDbFhzYk54YWVYdVgzamFPU1pvTGk4U01CSTE0WlU1SEI2VGw4WTdlYlJIcGpGR3dKQWdaQW9KNUlUZjllaEdRSlhIVk9sMWtPcDVIZ0FLQkYwRS82RlNIazA2U1NVQm9WUm0zRHh0YlNwREx4N0dRQ1ZVWW1lNFRPVklJaEpxdUc2NlFHSUJVc2lvRkVka0VaUVR5ZXFoZG1KS0llbjQrbWpoRnhPdzZlRDVvOWpsckpsSEZjTnlPby9mTURxSGxFbjZWQkI5aUFQMnlGUWthaW9rYlY2UHhmaVVSc0FMVFlXWkZsdmFFanowQmV2YUtreFBpblhsL0hoZ2xxUEEvRkhpMlQwbk92Nk13c0tRaWVOZlNuNFJXUEp2bzA0VHQ4MkFPaHJxK3dveUdCZWsvNE1GYVVRZmdhSGRMc1crRnl3Y25EcWh1MncvdzBIRy9lQXNrNjJUUnNsWk1qdXZMc3B2TU1wdlRQZWs0bktCRFRES2NIbGdHU2U1U3VVZWNtbVRyU0s4UzdGWEhzZ1JLaFdwVXBMZHM2VTJLUWoyRGZtSlRTTStGdElrMlhjR0hFOUswdWdVdEVTZVI1c2s5d3o2VEpvQjR3TXBwZlVHT0NkRnlTTHRueExNTUlrczM0Q1VrSDFjNnk2RFFTSzlxZFlOSjFyWFhWNmhkMWVqM002OEZWY0ppVm10ZEhPVzVQckI2bXVsMXRTRzA3M3NLZnlXYUc0cVdJM2xEVGtLemNLTjFZTDJ0YUtXNi90MDQzK1NxY0RuVVZsbzJzbEpScFVoSmV6MEVpa2VEazRVK08vdFIza3NKYzBtUEduV3F5K3I1Wnl6dkdvKzBpRzlqcWpvUEZxZ0hZTXR5dlQ5N1NlN1hXY2JwMFB4bkpRTGhiMjc0WXc4MDVGbERmWkdJbkZ1OWlyT2hMZVhHemdibGpnMnBKNTFBcDdwRmpnSXhITm9weWZqL0F5eUxtbEgvSTJhT3d3dmNMOFlPR054ckhkb2lRT0w1Y21EWnJ0ZDlzaHZabndvQ0ZCOHovVjFORVZCaWhvMmhWb1hlcHdFRy96RGd0NnFMUnFncjF1azNaN0dQOFV1NUJaeWRKOHdQZTBvanRjRFZTTVc5N2dra2tUZDhML0dKQTJtSjZsZGdaY09UdmNLZzlNZFh3Y2ZLd3lkZWczSkNzYjFCUWhUU0JXRXdZSC96eDM3Wm55bGNiMFB1bVRmVE95amUzM051QzhsQ0d6eGV4THQ4UDR4UDVscVAvMzI3UTFYK01vYlYyTDNObnZ0MjdmVk83SENVOWNPSHByWFRFQ2VVWDJqcklsZ3FqUExWK2RXTDIzQm9sUFhxTTYzZS9oMFJKNXY0SkdCVHRTc3psUGhONWZtaEJxNzhFNzFYRkl5RjNpbzk5WnJhaU1QZkVGcUtPdTUzbnNYNkd3MzBxdEtheURyTURuQWVobk8yNjMyc3Q2VGRCVnZMWm1UbXI5MDM1aXRnVURRVTcvcjRUUDNYdXF0cWIweTdNZ3J0RnozdW1OZmVOZkJ1T1VtaDc5L2paN3ozaDVUWHVpbmFDU08yTncweFg5c1NvWEIrMDBwSlB0ZnRkcFh6djZuUWYvdVh3PT0mbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7Ij48ZGVmcy8+PGc+PHBhdGggZD0iTSAxMDUgMjYwIEwgMTA1IDQxMy42MyIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMCwgMCwgMCkiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGQ9Ik0gMTA1IDQxOC44OCBMIDEwMS41IDQxMS44OCBMIDEwNSA0MTMuNjMgTCAxMDguNSA0MTEuODggWiIgZmlsbD0icmdiKDAsIDAsIDApIiBzdHJva2U9InJnYigwLCAwLCAwKSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDFweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAzNDBweDsgbWFyZ2luLWxlZnQ6IDEwNXB4OyI+PGRpdiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgYmFja2dyb3VuZC1jb2xvcjogcmdiKDI1NSwgMjU1LCAyNTUpOyAiPjxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMXB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjU1LCAyNTUsIDI1NSk7IHdoaXRlLXNwYWNlOiBub3dyYXA7Ij5jYWxsczwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxMDUiIHk9IjM0MyIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjExcHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPmNhbGxzPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB4PSI0NSIgeT0iMjAwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjYwIiBmaWxsPSJyZ2IoMjU1LCAyNTUsIDI1NSkiIHN0cm9rZT0icmdiKDAsIDAsIDApIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDExOHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDIzMHB4OyBtYXJnaW4tbGVmdDogNDZweDsiPjxkaXYgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7IiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPm5peC1idWlsZDwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxMDUiIHk9IjIzNCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPm5peC1idWlsZDwvdGV4dD48L3N3aXRjaD48L2c+PHBhdGggZD0iTSAxMDUgMTQwIEwgMTA1IDE5My42MyIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMCwgMCwgMCkiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGQ9Ik0gMTA1IDE5OC44OCBMIDEwMS41IDE5MS44OCBMIDEwNSAxOTMuNjMgTCAxMDguNSAxOTEuODggWiIgZmlsbD0icmdiKDAsIDAsIDApIiBzdHJva2U9InJnYigwLCAwLCAwKSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDFweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAxNzBweDsgbWFyZ2luLWxlZnQ6IDEwNXB4OyI+PGRpdiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgYmFja2dyb3VuZC1jb2xvcjogcmdiKDI1NSwgMjU1LCAyNTUpOyAiPjxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMXB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjU1LCAyNTUsIDI1NSk7IHdoaXRlLXNwYWNlOiBub3dyYXA7Ij5Vc2VkIGJ5PC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9IjEwNSIgeT0iMTc0IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTFweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+VXNlZCBieTwvdGV4dD48L3N3aXRjaD48L2c+PHBhdGggZD0iTSAyMCAzMCBMIDIwIDAgTCAxOTAgMCBMIDE5MCAzMCIgZmlsbD0icmdiKDI1NSwgMjU1LCAyNTUpIiBzdHJva2U9InJnYigwLCAwLCAwKSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PHBhdGggZD0iTSAyMCAzMCBMIDIwIDE0MCBMIDE5MCAxNDAgTCAxOTAgMzAiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDAsIDAsIDApIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHBvaW50ZXItZXZlbnRzPSJub25lIi8+PHBhdGggZD0iTSAyMCAzMCBMIDE5MCAzMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMCwgMCwgMCkiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgcG9pbnRlci1ldmVudHM9Im5vbmUiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiIHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTY4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTVweDsgbWFyZ2luLWxlZnQ6IDIxcHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyIgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiPjxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMnB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij5kZWZhdWx0Lm5peDwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxMDUiIHk9IjE5IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+ZGVmYXVsdC5uaXg8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IHg9IjIwIiB5PSIzMCIgd2lkdGg9IjE3MCIgaGVpZ2h0PSIxMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBmbGV4LXN0YXJ0OyB3aWR0aDogMTYwcHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogODVweDsgbWFyZ2luLWxlZnQ6IDI2cHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogbGVmdDsgbWF4LWhlaWdodDogMTA2cHg7IG92ZXJmbG93OiBoaWRkZW47IiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPjxkaXYgYWxpZ249ImxlZnQiPmRlcml2YXRpb24gezwvZGl2PjxkaXYgYWxpZ249ImxlZnQiPsKgIG5hbWUgPSAiaGVsbG8iOzwvZGl2PjxkaXYgYWxpZ249ImxlZnQiPsKgIHN5c3RlbSA9ICJ4ODZfNjQtbGludXgiOzwvZGl2PjxkaXYgYWxpZ249ImxlZnQiPsKgIGJ1aWxkZXIgPSAuL2J1aWxkZXIuc2g7PC9kaXY+PGRpdiBhbGlnbj0ibGVmdCI+wqAgZ2NjID0gbml4cGtncy5nY2M7PC9kaXY+PGRpdiBhbGlnbj0ibGVmdCI+wqAgbWFrZSA9IG5peHBrZ3MubWFrZTs8YnIgLz48L2Rpdj48ZGl2IGFsaWduPSJsZWZ0Ij59PGJyIC8+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9IjI2IiB5PSI4OSIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiPmRlcml2YXRpb24gey4uLjwvdGV4dD48L3N3aXRjaD48L2c+PHBhdGggZD0iTSAxMDUgNDgwIEwgMTA1IDU0My42MyIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMCwgMCwgMCkiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPjxwYXRoIGQ9Ik0gMTA1IDU0OC44OCBMIDEwMS41IDU0MS44OCBMIDEwNSA1NDMuNjMgTCAxMDguNSA1NDEuODggWiIgZmlsbD0icmdiKDAsIDAsIDApIiBzdHJva2U9InJnYigwLCAwLCAwKSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDFweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiA1MTVweDsgbWFyZ2luLWxlZnQ6IDEwNXB4OyI+PGRpdiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgYmFja2dyb3VuZC1jb2xvcjogcmdiKDI1NSwgMjU1LCAyNTUpOyAiPjxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMXB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjU1LCAyNTUsIDI1NSk7IHdoaXRlLXNwYWNlOiBub3dyYXA7Ij5QdXRzIGNvbXBpbGVkIGZpbGVzIGludG88L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMTA1IiB5PSI1MTgiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMXB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5QdXRzIGNvbXBpbGVkIGZpbGVzIGludG88L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IHg9IjAiIHk9IjQyMCIgd2lkdGg9IjIxMCIgaGVpZ2h0PSI2MCIgZmlsbD0icmdiKDI1NSwgMjU1LCAyNTUpIiBzdHJva2U9InJnYigwLCAwLCAwKSIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAyMDhweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiA0NTBweDsgbWFyZ2luLWxlZnQ6IDFweDsiPjxkaXYgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7IiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPi9uaXgvc3RvcmUvYWJjZGVmLWJ1aWxkZXIuc2g8L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMTA1IiB5PSI0NTQiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMnB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4vbml4L3N0b3JlL2FiY2RlZi1idWlsZGVyLnNoPC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB4PSIxMjUiIHk9IjI4NSIgd2lkdGg9IjI3MCIgaGVpZ2h0PSIxMzAiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgZmxleC1zdGFydDsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgZmxleC1zdGFydDsgd2lkdGg6IDI2MnB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDI3NXB4OyBtYXJnaW4tbGVmdDogMTMwcHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogbGVmdDsgbWF4LWhlaWdodDogMTQwcHg7IG92ZXJmbG93OiBoaWRkZW47IiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPjxoMT5lbnZpcm9ubWVudCB2YXJpYWJsZXM8YnIgLz48L2gxPjxwPmV4cG9ydCBuYW1lPSJoZWxsbyI8YnIgLz5leHBvcnQgc3lzdGVtPSJ4ODZfNjQtbGludXgiOzxiciAvPmV4cG9ydCBidWlsZGVyPSIvbml4L3N0b3JlL2FiY2RlZi1idWlsZGVyLnNoIjxiciAvPmV4cG9ydCBnY2M9Ii9uaXgvc3RvcmUvYjJvM3Jhdm9zdi1nY2MiPGJyIC8+ZXhwb3J0IG1ha2U9Ii9uaXgvc3RvcmUvYnZvYTg3Z3dvODQ3LW1ha2UiPGJyIC8+PC9wPjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxMzAiIHk9IjI4NyIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiPmVudmlyb25tZW50IHZhcmlhYmxlcy4uLjwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgeD0iMCIgeT0iNTUwIiB3aWR0aD0iMjEwIiBoZWlnaHQ9IjYwIiBmaWxsPSJyZ2IoMjU1LCAyNTUsIDI1NSkiIHN0cm9rZT0icmdiKDAsIDAsIDApIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDIwOHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDU4MHB4OyBtYXJnaW4tbGVmdDogMXB4OyI+PGRpdiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiIGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTJweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+L25peC9zdG9yZS8yNzNoMGFzZGJpLWhlbGxvPC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9IjEwNSIgeT0iNTg0IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+L25peC9zdG9yZS8yNzNoMGFzZGJpLWhlbGxvPC90ZXh0Pjwvc3dpdGNoPjwvZz48L2c+PHN3aXRjaD48ZyByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiLz48YSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLC01KSIgeGxpbms6aHJlZj0iaHR0cHM6Ly93d3cuZHJhd2lvLmNvbS9kb2MvZmFxL3N2Zy1leHBvcnQtdGV4dC1wcm9ibGVtcyIgdGFyZ2V0PSJfYmxhbmsiPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtc2l6ZT0iMTBweCIgeD0iNTAlIiB5PSIxMDAlIj5UZXh0IGlzIG5vdCBTVkcgLSBjYW5ub3QgZGlzcGxheTwvdGV4dD48L2E+PC9zd2l0Y2g+PC9zdmc+
```

 
 
### Passing files to a derivation

Remember when we said every attribute of the attribute set is passed as an environment variable? Well, paths in `nix` are special. Any path is copied to a computed path in the [nix store].

By convention the attribute `src` is used to point to the source files needed in a derivation.

For example `src = ./my-sources;` is converted in the env variable `src=/nix/store/$hash-my-sources/`.

### Dependencies

How do we handle these you might ask? Remember when we said the basic `derivation` is dumb? Well, it is, because all you need to do is add them as (you guessed it) attributes to the attribut set.
When converted to env vars, packages are converted store paths.

For example `python = nixpkgs.python3;` is converted to the env var `python=/nix/store/$hash-python3`. To actually use it, the builder will have to include `$python/bin` in `PATH`.

This is already a good reason to use `mkDerivation` from [nixpkgs](/nix/nixpkgs/index).

There is some additional magic done for binaries that depend on libraries

> TODO add a link
{.is-warning}

### Special folders

In examples below, you'll see some special folders in `$out` like `bin/` and `share/`.
These are treated specially by `nix` when a package is installed.

> TODO find a list of special directories and what they mean
{.is-warning}

 - `$out/bin/` - automatically added to `PATH` on installation by some tools

## Building a derivation

Call `nix-build` in the folder containing `default.nix`.
Calling `nix-build` will output a store path and a symbolic link to it called `result`, which you will be able to use to call the compiled binary. 

> TODO add a section about `default.nix`
{.is-warning}

## Examples

### A `make` project

In this example we build the simple `hello-world` program. All it does it say "Hello world!".

**`setup.sh`**

```bash
# Add packages to path
for package in $buildDep ; do
  export PATH=$PATH:$package/bin
done
```

**`builder.sh`**

```bash
#/usr/bin/env bash

# Do some necessary setup
source $setup

# extract source
mkdir -p $out/src
cd $out/src
tar  xvf $src --strip=1

# compile program
cd $out/src
./configure
make

# Move compiled program into bin dir
mkdir $out/bin
mv hello $out/bin
```

**default.nix**

```nix
{
  pkgs ? (import <nixpkgs> {})
}:

builtins.derivation rec {
  # Required parameters
  name = "hello-${version}";
  system = "x86_64-linux";
  builder = "${pkgs.bash}/bin/bash";
  args = [ ./builder.sh ];  # Execute builder script with bash

  # File to help setup
  setup = ./setup.sh;

  # Retrieving the source package
  version = "2.12";
  src = builtins.fetchurl "https://mirror.lyrahosting.com/gnu/hello/hello-${version}.tar.gz";

  # Dependencies for building the package
  buildDeps = with pkgs; [
    coreutils
    gawk
    gcc
    gnugrep
    gnumake
    gnused
    gnutar
    gzip
  ];
}
```

Calling `nix-build` will give us a `result/` symbolic link to the store path which we can use to call our compiled binary! 
Run `result/bin/hello` and you should be greeted :)

#### enter development environment

Building is all nice and good, but rarely does everything work on the first try.
To enter an environment with the environment variables set, you can use `nix-shell`.

You should be dropped into a `bash` shell, but you won't have access to `make`, `sed` or any other utils yet!
That's where the `setup.sh` script comes in. Remember, the path to it is stored in the `setup` environment variable.
Sourcing it with `source $setup` will now put you in a very similar environment to `nix-build`.

The only thing missing is the source code. It will have been downloaded before entering the shell.
Run `echo $src` to see where it is.

You can extract it to your working directory with `tar xvf $src`!

## References

 - [builtins]
 - [nix manual][derivationRef]

[builtins]: https://nixos.org/manual/nix/stable/language/builtins
[derivationRef]: https://nixos.org/manual/nix/stable/language/derivations
[nix store]: /nix/store